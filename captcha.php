<?php
include_once('utils/Session.php');

header("Content-type: image/jpg");

$img_string = "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";
$data = base64_decode($img_string);

$string = rand(1000,9999) . ' ' . rand(1000,9999); // replace this with $_POST, $_SESSION, or anything
$im     = imagecreatefromstring($data);
$color = imagecolorallocate($im, 255, 255, 255);
$px     = (imagesx($im) - 7.5 * strlen($string)) / 2;

Session::write('captcha', $string);

imagestring($im, 5, $px, 9, $string, $color);
imagejpeg($im);
imagedestroy($im);


/*
* References
* http://stackoverflow.com/questions/4572121/how-to-create-gd-image-from-base64-encoded-jpeg
* http://www.base64-image.de/
* http://www.99points.info/2011/01/recaptcha-style-captcha-with-jquery-and-php/
*/